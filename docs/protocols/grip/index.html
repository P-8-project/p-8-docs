<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>P-8 | Documentation | Generic Realtime Intermediary Protocol</title>
  <meta name="description" content="Get started with realtime using our developer guide. ">
  <link rel="canonical" href="index.html">
  <link rel="alternate" type="application/rss+xml" title="P-8" href="../../../feed.xml" />

  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- open graph info -->
  <meta property="og:title" content="P-8 | Documentation | Generic Realtime Intermediary Protocol">
  <meta property="og:site_name" content="P-8">
  <meta property="og:type" content="website">
  <meta property="og:description" content="Get started with realtime using our developer guide.">
  <meta property="og:image" content="https://P-8.org/image/icon-300x300.png">
  <meta name="twitter:image" content="https://P-8.org/image/icon-300x300.png" />

  <link rel="icon" type="image/png" href="../../../image/favicon.png">

  <!-- Stylesheets -->
  <link rel="stylesheet" href="../../../css/main.css">

  <!-- APIs -->
  <link href="https://fonts.googleapis.com/css?family=Merriweather+Sans:300,400|Merriweather:300,400" rel="stylesheet">

  <!-- jQuery -->
  <script
    src="https://code.jquery.com/jquery-2.2.4.min.js"
    integrity="sha256-BbhdlvQf/xTY9gja0Dq3HiwQF8LaCRTXxZKRutelT44="
    crossorigin="anonymous"></script>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->

  <script src="../../../js/handlebars.js"></script>
  <script src="../../../js/tabbed-examples.js"></script>
</head>

  <body class="page docs">
    <div style="display: none;"><img src="../../../image/dots-div.svg" /></div>

    <header class="primary wrapper">
  <nav class="primary" role="navigation" id="top">
    <aside class="logo">
      <a href="../../../index.html"><img src="../../../image/logo.png" /></a>
    </aside>
    <aside class="links">
      <a href="../../about/index.html">Docs</a>
      <a href="https://github.com/P-8-project/P-8">Code</a>
      <a href="../../about/index.html#support">Community</a>
    </aside>
    <img class="mobile-handle" src="../../../image/mobile-handle.svg" />
  </nav>
</header>

<div class="consent-box" id="consent-box">
  <div class="width">
    <p>We use cookies to provide our services and for analytics and marketing. To find out more about our use of cookies, please see our <a href="https://fanout.io/legal/privacy-policy/">Privacy Policy</a>. By continuing to browse our website, you agree to our use of cookies.</p>
    <button href="#" class="button ghost" id="consent-ok">OK</button>
  </div>
</div>


    <header class="page-header"><h1>Documentation</h1></header>
    <div class="div"></div>

    <div class="content wrapper" style="position: relative;">
      <nav class="sidebar">
        <ul>
          
          
          <li><a href="../../about/index.html">About</a></li>
          
            <ul>
              
              <li><a href="../../about/index.html#introduction">Introduction</a></li>
              
              
              <li><a href="../../about/index.html#how-it-works">How it works</a></li>
              
              
              <li><a href="../../about/index.html#support">Support</a></li>
              
              
              <li><a href="../../about/index.html#license">License</a></li>
              
              
            </ul>
          
          
          
          <li><a href="../../install/index.html">Install</a></li>
          
            <ul>
              
              <li><a href="../../install/index.html#packages">Packages</a></li>
              
              
              <li><a href="../../install/index.html#building-from-source">Building from source</a></li>
              
              
              <li><a href="../../install/index.html#running">Running</a></li>
              
              
              <li><a href="../../install/index.html#upgrading">Upgrading</a></li>
              
              
            </ul>
          
          
          
          <li><a href="../../getting-started/index.html">Getting started</a></li>
          
            <ul>
              
              <li><a href="../../getting-started/index.html#quickstart">Quickstart</a></li>
              
              
              <li><a href="../../getting-started/index.html#video-walkthrough">Video walkthrough</a></li>
              
              
            </ul>
          
          
          
          <li><a href="../../configuration/index.html">Configuration</a></li>
          
            <ul>
              
              <li><a href="../../configuration/index.html#config-files">Config files</a></li>
              
              
              <li><a href="../../configuration/index.html#routes">Routes</a></li>
              
              
              <li><a href="../../configuration/index.html#proxying">Proxying</a></li>
              
              
              <li><a href="../../configuration/index.html#ssl">SSL</a></li>
              
              
            </ul>
          
          
          
          <li><a href="../../usage/index.html">Usage</a></li>
          
            <ul>
              
              <li><a href="../../usage/index.html#subscribing">Subscribing</a></li>
              
              
              <li><a href="../../usage/index.html#publishing">Publishing</a></li>
              
              
              <li><a href="../../usage/index.html#transports">Transports</a></li>
              
              
              <li><a href="../../usage/index.html#libraries">Libraries</a></li>
              
              
              <li><a href="../../usage/index.html#browser-features">Browser features</a></li>
              
              
            </ul>
          
          
          
          <li><a href="../../advanced/index.html">Advanced topics</a></li>
          
            <ul>
              
              <li><a href="../../advanced/index.html#sequence-ids">Sequence IDs</a></li>
              
              
              <li><a href="../../advanced/index.html#message-de-duping">Message de-duping</a></li>
              
              
              <li><a href="../../advanced/index.html#keep-alives">Keep-alives</a></li>
              
              
              <li><a href="../../advanced/index.html#commands">Commands</a></li>
              
              
              <li><a href="../../advanced/index.html#stats-socket">Stats socket</a></li>
              
              
              <li><a href="../../advanced/index.html#message-filtering">Message filtering</a></li>
              
              
              <li><a href="../../advanced/index.html#paged-streaming">Paged streaming</a></li>
              
              
              <li><a href="../../advanced/index.html#reliability">Reliability</a></li>
              
              
              <li><a href="../../advanced/index.html#message-queues">Message queues</a></li>
              
              
              <li><a href="../../advanced/index.html#subscription-forwarding">Subscription forwarding</a></li>
              
              
              <li><a href="../../advanced/index.html#multiple-processes">Multiple processes</a></li>
              
              
              <li><a href="../../advanced/index.html#proxy-chaining">Proxy chaining</a></li>
              
              
            </ul>
          
          
          
          <li><a href="../../examples/index.html">Examples</a></li>
          
            <ul>
              
              <li><a href="../../examples/index.html#headline">Headline</a></li>
              
              
              <li><a href="../../examples/index.html#leaderboard">Leaderboard</a></li>
              
              
              <li><a href="../../examples/index.html#chat">Chat</a></li>
              
              
              <li><a href="../../examples/index.html#todo-list">Todo list</a></li>
              
              
              <li><a href="../../examples/index.html#live-text-editor">Live text editor</a></li>
              
              
              <li><a href="../../examples/index.html#webhookinbox">WebhookInbox</a></li>
              
              
              <li><a href="../../examples/index.html#audio-stream">Audio stream</a></li>
              
              
            </ul>
          
          
          
          <li><a href="../index.html">Protocols</a></li>
          
            <ul>
              
              <li><a href="index.html">Generic Realtime Intermediary Protocol</a></li>
              
              
              <li><a href="../websocket-over-http/index.html">WebSocket-over-HTTP</a></li>
              
              
              <li><a href="https://rfc.zeromq.org/spec:33/ZHTTP/">ZHTTP</a></li>
              
              
            </ul>
          
          
        </ul>
      </nav>

      <nav class="navbar-mobile-handle">Docs Menu</nav>

      <section class="docs">
      <h1 id="generic-realtime-intermediary-protocol">Generic Realtime Intermediary Protocol</h1>

<h2 id="introduction">Introduction</h2>

<p>The Generic Realtime Intermediary Protocol (“GRIP”) makes it possible for a web service to delegate realtime push behavior to a proxy component. Listening entities, such as long-lived HTTP or WebSocket connections, are managed by the proxy. The web service backend can instruct the proxy to associate listeners with publish-subscribe channels. The web service backend may publish data to channels, and the proxy will relay the data to all associated listeners. When data is published, the entirety of the transmission is specified, allowing complete control over the application protocol exposed to listeners.</p>

<p><img src="../../../image/grip-abstract.png" alt="grip-abstract" /></p>

<p>There are many advantages to this approach:</p>

<ol>
  <li>
    <p>Reusability. The primary goal of GRIP is to isolate the common aspects of realtime push functionality into a reusable proxy component. A GRIP proxy should be able to power any kind of web service, with any kind of API contract, for any kind of application, running at any organization. Adding new endpoints, changing protocol flows, or using different data formats should be possible without modifying the proxy.</p>
  </li>
  <li>
    <p>Simplified routing. Knowing if or where a listening entity may be connected in a cluster makes for a tricky routing problem. It’s simpler for data sources to publish data to channels rather than to individual listeners. With GRIP, data can be sent to a sole proxy, or to each proxy instance in a cluster (either directly or optionally via a message queue), without having to know whether or not any listeners are present.</p>
  </li>
  <li>
    <p>High scalability. Many listeners may be associated with a single channel. This means data can be sent to the proxy once and multicasted to a set of listeners. Proxies can be chained to message brokers to form a multi-tiered architecture capable of massive output (e.g. publishing to a million connections at the same time across a set of proxies).</p>
  </li>
  <li>
    <p>Stateless development. In the case of long-lived HTTP connections such as long-polling or streaming, a GRIP proxy communicates to a backend server using short-lived HTTP requests. This means the backend doesn’t have to maintain long-lived connections and it can generally operate statelessly; it can handle incoming requests statelessly and publish data to the proxy statelessly. In the case of WebSockets, a proxy and backend may optionally choose to communicate statelessly on the backend side (e.g. via HTTP).</p>
  </li>
</ol>

<h2 id="transports">Transports</h2>

<p>There are two main transports defined: HTTP and WebSocket.</p>

<h3 id="http">HTTP</h3>

<p>The HTTP GRIP transport allows a proxy to hold open HTTP requests on behalf of a backend web service, facilitating realtime data push over those held requests. There are two hold modes: <code class="language-plaintext highlighter-rouge">response</code> and <code class="language-plaintext highlighter-rouge">stream</code>.</p>

<p>When a request is made to the proxy, the proxy forwards it to a backend server. The proxy may include special headers. The following request headers are defined:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Grip-Sig</code>: A JSON Web Token signed with a key known between the proxy and the backend server. The backend can look for this header if it needs to know whether or not a request came from a known GRIP proxy. The JWT claim SHOULD contain an <code class="language-plaintext highlighter-rouge">iss</code> field as a hint for which key is being used (in case there are multiple possible keys). The JWT claim MUST contain an <code class="language-plaintext highlighter-rouge">exp</code> field. If the token cannot be fully verified for any reason, including expiration, then the backend should behave as if the header wasn’t present.</li>
</ul>

<p>When the backend responds to the request, it MAY specify instructions to the proxy about how to behave, such as the hold mode to use and any channels that should be associated with the request. Once the backend has responded, the transaction between the proxy and the backend is complete. However, the request between the client and the proxy remains open according to the instructions provided.</p>

<p>Instructions are provided via headers. The following response headers are defined:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">Grip-Hold</code>: The hold mode, either <code class="language-plaintext highlighter-rouge">response</code> or <code class="language-plaintext highlighter-rouge">stream</code>. This header MUST be present in order for the proxy to take GRIP-related action, otherwise it should behave normally (e.g. by relaying the response back to the client).</li>
  <li><code class="language-plaintext highlighter-rouge">Grip-Channel</code>: A channel to subscribe the request to, encoded as UTF-8. The channel can contain any Unicode character that is conveyable over an HTTP header and isn’t ambiguous (beware of whitespace and commas). There are no characters with special meaning. Multiple <code class="language-plaintext highlighter-rouge">Grip-Channel</code> headers may be specified in the response, to subscribe multiple channels to the request. At least one <code class="language-plaintext highlighter-rouge">Grip-Channel</code> header MUST be present if <code class="language-plaintext highlighter-rouge">Grip-Hold</code> is present. This header type may include parameters. The only defined parameter is <code class="language-plaintext highlighter-rouge">prev-id</code>, which specifies the ID of data that was last published to the specified channel (used to avoid a race condition). The <code class="language-plaintext highlighter-rouge">prev-id</code> parameter is OPTIONAL.</li>
  <li><code class="language-plaintext highlighter-rouge">Grip-Timeout</code>: The length of time the request should be held open before timing out. This header is OPTIONAL and only applies to the <code class="language-plaintext highlighter-rouge">response</code> mode. If omitted, the proxy SHOULD use a default of 55 seconds.</li>
  <li><code class="language-plaintext highlighter-rouge">Grip-Keep-Alive</code>: Data to be sent to the client after a certain amount of activity passes. This header is OPTIONAL and only applies to the <code class="language-plaintext highlighter-rouge">stream</code> mode. This header type may include optional parameters. Defined parameters are <code class="language-plaintext highlighter-rouge">timeout</code> and <code class="language-plaintext highlighter-rouge">format</code>. The <code class="language-plaintext highlighter-rouge">timeout</code> parameter specifies the length of time a request must be idle before the keep alive data is sent. If omitted, the proxy SHOULD use a default of 55 seconds. The <code class="language-plaintext highlighter-rouge">format</code> parameter specifies the format of the keep alive data. Allowed values are <code class="language-plaintext highlighter-rouge">raw</code>, <code class="language-plaintext highlighter-rouge">cstring</code>, and <code class="language-plaintext highlighter-rouge">base64</code>. If omitted, <code class="language-plaintext highlighter-rouge">raw</code> is assumed. For example, if a newline character should be sent to the client after 20 seconds of inactivity, the following header could be used: <code class="language-plaintext highlighter-rouge">Grip-Keep-Alive: \n; format=cstring; timeout=20</code>.</li>
</ul>

<p>To publish data to any held open connections, <code class="language-plaintext highlighter-rouge">http-response</code> and/or <code class="language-plaintext highlighter-rouge">http-stream</code> payloads must be transmitted to the proxy using the <a href="index.html#control-service">Control Service</a>. Examples:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"http-response": {
  "code": int,
  "status", str,
  "headers": {
    name: str,
    ...
  },
  "body": str,
  "body-bin": base64 str
}

"http-stream": {
  "content": str,
  "content-bin": base64 str
}
</code></pre></div></div>

<h3 id="websocket">WebSocket</h3>

<p>The WebSocket GRIP transport allows a proxy to associate channels with WebSocket connections, so that data may be published to these connections.</p>

<p>When a client makes a WebSocket connection to the proxy, the proxy makes a WebSocket connection to the backend server. In this connection request, the proxy includes the <code class="language-plaintext highlighter-rouge">grip</code> extension in the <code class="language-plaintext highlighter-rouge">Sec-WebSocket-Extensions</code> header. The proxy SHOULD also include a <code class="language-plaintext highlighter-rouge">Grip-Sig</code> header as described in the <a href="index.html#http">HTTP</a> section:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nf">GET</span> <span class="nn">/websocket/path/</span> <span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span>
<span class="na">Host</span><span class="p">:</span> <span class="s">example.com</span>
<span class="na">Upgrade</span><span class="p">:</span> <span class="s">websocket</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">Upgrade</span>
<span class="na">Grip-Sig</span><span class="p">:</span> <span class="s">[... JWT ...]</span>
<span class="na">Sec-WebSocket-Version</span><span class="p">:</span> <span class="s">13</span>
<span class="na">Sec-WebSocket-Key</span><span class="p">:</span> <span class="s">dGhlIHNhbXBsZSBub25jZQ=</span>
<span class="na">Sec-WebSocket-Extensions</span><span class="p">:</span> <span class="s">grip</span>
<span class="s">...</span>
</code></pre></div></div>

<p>The backend server then accepts the connection with the proxy by responding with status code 101. In order to enable GRIP functionality, the backend must include the <code class="language-plaintext highlighter-rouge">grip</code> extension in its response. If the backend does not include this extension, then the proxy MUST assume that the backend server is not GRIP capable and treat the session as a passthrough.</p>

<p>If the backend server provides the <code class="language-plaintext highlighter-rouge">grip</code> extension, then the proxy will know that the backend is GRIP capable and the backend may send special control messages to the proxy. In order to disambiguate control messages from normal messages, the backend denotes the type of message by including a prefix in the payload of the message. If the message spans multiple frames, then the prefix would be included in the first frame only. By default, the prefix for normal messages is <code class="language-plaintext highlighter-rouge">m:</code> and the prefix for control messages is <code class="language-plaintext highlighter-rouge">c:</code>. The proxy MUST strip off the prefix before relaying or processing.</p>

<p>The <code class="language-plaintext highlighter-rouge">grip</code> extension has an optional parameter called <code class="language-plaintext highlighter-rouge">message-prefix</code> that the backend server can use to override the prefix for normal messages. The backend can even specify a blank string for this value, to indicate that there should be no prefix at all. This can be useful if the backend speaks entirely in JSON, in which case there is no chance of conflict with control messages (a JSON payload would never begin with <code class="language-plaintext highlighter-rouge">c:</code>). For example:</p>

<div class="language-http highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">HTTP</span><span class="o">/</span><span class="m">1.1</span> <span class="m">101</span> <span class="ne">Switching Protocols</span>
<span class="na">Upgrade</span><span class="p">:</span> <span class="s">websocket</span>
<span class="na">Connection</span><span class="p">:</span> <span class="s">Upgrade</span>
<span class="na">Sec-WebSocket-Accept</span><span class="p">:</span> <span class="s">s3pPLMBiTxaQ9kYGzzhZRbK+xOo=</span>
<span class="na">Sec-WebSocket-Extensions</span><span class="p">:</span> <span class="s">grip; message-prefix=""</span>
<span class="s">...</span>
</code></pre></div></div>

<p>Control messages are JSON format, encoded as an object with a <code class="language-plaintext highlighter-rouge">type</code> field indicating the type of control message. All other fields in the object are specific to the control message type. The following control messages are defined:</p>

<ul>
  <li><code class="language-plaintext highlighter-rouge">{ "type": "subscribe", "channel": "{channel}" }</code></li>
  <li><code class="language-plaintext highlighter-rouge">{ "type": "unsubscribe", "channel": "{channel}" }</code></li>
  <li><code class="language-plaintext highlighter-rouge">{ "type": "detach" }</code></li>
</ul>

<p>Note that control messages are only ever sent by the backend server to the proxy. The proxy does not send control messages to the backend, and the client has no awareness of GRIP. The backend uses the <code class="language-plaintext highlighter-rouge">subscribe</code> and <code class="language-plaintext highlighter-rouge">unsubscribe</code> messages to control the GRIP channels that the client’s WebSocket connection is subscribed to. A channel can contain any Unicode character and there are no characters with special meaning.</p>

<p>The <code class="language-plaintext highlighter-rouge">detach</code> message is used to disconnect the backend from the proxy without the proxy disconnecting from the client. Once a connection is detached, any further messages the proxy receives from the client are dropped. Detached mode only makes sense if the connection has been subscribed to at least one channel and the client is not expected to send anything further. This is useful if the connection is used only for one-way transmission.</p>

<p>The backend server may publish data to the proxy using the <code class="language-plaintext highlighter-rouge">ws-message</code> format, transmitted to the proxy using the <a href="index.html#control-service">Control Service</a>. Example:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"ws-message": {
  "content": str,
  "content-bin": base64 str
}
</code></pre></div></div>

<p>This format contains just one child field, <code class="language-plaintext highlighter-rouge">content</code> or <code class="language-plaintext highlighter-rouge">content-bin</code>, containing an entire message to be relayed to all clients subscribed to the channel being published to. The <code class="language-plaintext highlighter-rouge">content</code> field is a string containing a text message. The <code class="language-plaintext highlighter-rouge">content-bin</code> field is a string containing a binary message encoded in Base64.</p>

<h2 id="control-service">Control Service</h2>

<p>A GRIP proxy may be controlled via the Extensible Pubsub Control Protocol (EPCP). GRIP requires support for the publish endpoint, which is used to send items over HTTP or WebSocket connections that have been bound to channels.</p>

<p>EPCP defines a generalized and extensible way of publishing data through a publish-subscribe service using HTTP. A pubsub service offering an EPCP interface must make a REST API available at a known base URI. For example, if the base URI of the EPCP service is <code class="language-plaintext highlighter-rouge">http://localhost:9000/epcp</code>, then method endpoints would be appended onto that. For example, the <code class="language-plaintext highlighter-rouge">publish</code> endpoint would be available at <code class="language-plaintext highlighter-rouge">http://localhost:9000/epcp/publish/</code>.</p>

<h3 id="publishing">Publishing</h3>

<p>For example, a publish request may look like this:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>POST /publish/ HTTP/1.1
Host: localhost:5561
Content-Type: application/json

{
  "items": [
    {
      "channel": str,
      "id": str,
      "prev-id": str,
      "formats": {
        format_1: {},
        format_2: {},
        ...
      },
      ...
    },
    ...
  ]
}
</code></pre></div></div>

<p>More than one item may be published in a single request. Each item may contain one or more formats by providing field names for each format along with their values. Item formats may be specified in further specifications. EPCP alone does not define any item formats. GRIP defines the following item formats: <code class="language-plaintext highlighter-rouge">http-response</code> (see <a href="index.html#http">HTTP</a>), <code class="language-plaintext highlighter-rouge">http-stream</code> (see <a href="index.html#http">HTTP</a>, and <code class="language-plaintext highlighter-rouge">ws-message</code> (see <a href="index.html#websocket">WebSocket</a>).</p>

      </section>

    </div><!-- content -->

    <div class="div"></div>

    <section class="cta">
      <div class="wrapper">

        <aside class="github">
          <a href="https://github.com/P-8-project/P-8"><img src="../../../image/github.svg"></a>
          <section class="meta">
            <iframe src="http://ghbtns.com/github-btn.html?user=fanout&repo=P-8&type=watch&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="110" height="20"></iframe>
            <iframe src="http://ghbtns.com/github-btn.html?user=fanout&repo=P-8&type=fork&count=true" allowtransparency="true" frameborder="0" scrolling="0" width="95" height="20"></iframe>
          </section>
          <a class="link" href="https://github.com/P-8-project/P-8">https://github.com/P-8-project/P-8</a>
        </aside>

      </div>
    </section><!-- cta -->

    <footer class="primary wrapper">
  <nav class="primary" role="navigation" id="top">
    <aside class="links">
      <a href="../../../index.html">Home</a>
      <a href="../../about/index.html">Docs</a>
      <a href="../../about/index.html#support">Community</a>
      <a href="https://github.com/P-8-project/P-8">GitHub</a>
    </aside>
    <a class="logo" href="../../../index.html"><img src="../../../image/logo.png" /></a>
  </nav>
  <aside class="fanout">
    Brought to you by <a href="https://fastly.com"><img src="../../../image/fastly.svg" /></a>
    <small>&copy; 2025 Fastly, Inc.</small>
  </aside>
</footer>
<script src="../../../js/main.js"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>


  </body>
</html>
